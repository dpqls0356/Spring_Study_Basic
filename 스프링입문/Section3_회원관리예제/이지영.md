# íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ

## 1. ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

- ë°ì´í„° íšŒì› ID, ì´ë¦„
- ê¸°ëŠ¥ : íšŒì› ë“±ë¡, ì¡°íšŒ
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ(ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤)

- ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°
    - ì»¨íŠ¸ë¡¤ëŸ¬ â†’ ì„œë¹„ìŠ¤ â†’ ë¦¬í¬ì§€í† ë¦¬ â†’ DB
    - ì»¨íŠ¸ë¡¤ëŸ¬ â†’ ë„ë©”ì¸ , ì„œë¹„ìŠ¤ â†’ ë„ë©”ì¸,  ë¦¬í¬ì§€í† ë¦¬ â†’ ë„ë©”ì¸
    1. ì»¨íŠ¸ë¡¤ëŸ¬: ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
    2. ì„œë¹„ìŠ¤ : **ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´**ë¥¼ ê°€ì§€ê³  í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ (ex. íšŒì› ì¤‘ë³µê°€ì… ë¶ˆê°€)
    3. ë¦¬í¬ì§€í† ë¦¬: ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
    4. ë„ë©”ì¸: íšŒì›, ì£¼ë¬¸, ì¿ í°ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ì£¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬ë˜ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´**!

- í´ë˜ìŠ¤ ì˜ì¡´ ê´€ê³„
- ì•„ì§ **ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ X** â†’ íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì¦‰, íšŒì›ì„ ì €ì¥í•˜ëŠ” ê²ƒì€ **ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„**
- ê°œë°œì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ˆê¸° ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” êµ¬í˜„ì²´ë¡œ ê°€ë²¼ìš´ ë©”ëª¨ë¦¬ê¸°ë°˜ì˜ ë°ì´í„° ì €ì¥ì†Œ ì‚¬ìš©

---

## 2. íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

- `Member`ê°ì²´
    
    ```java
    package com.eejuuung.hellospring.domain;
    
    public class Member {
    
        private Long id;
        private String name;
    
        public Long getId() {
            return id;
        }
    
        public void setId(Long id) {
            this.id = id;
        }
    
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    }
    ```
    
- `MemberRepository`ì¸í„°í˜ì´ìŠ¤
    
    ```java
    package com.eejuuung.hellospring.repository;
    
    import com.eejuuung.hellospring.domain.Member;
    
    import java.util.List;
    import java.util.Optional;
    
    public interface MemberRepository {
        Member save(Member member);
    
        // Optional -> ì—†ìœ¼ë©´ nullë¡œ ë°˜í™˜ë˜ëŠ” ë©”ì†Œë“œì— ìš”ì¦˜ì€Optionalë¡œ ê°ì‹¸ì„œ ë°˜í™˜ì„ ë§ì´í•¨.
        Optional<Member> findById(Long id);
        Optional<Member> findByName(String name);
        List<Member> findAll();
    }
    ```
    
- `MemoryMemberRepository implements MemberRepository` í´ë˜ìŠ¤
    
    ```java
    package com.eejuuung.hellospring.repository;
    
    import com.eejuuung.hellospring.domain.Member;
    
    import java.util.*;
    
    public class MemoryMemberRepository implements MemberRepository{
        private static Map<Long,Member> store = new HashMap<>();
        private static long sequence = 0L;
    
        @Override
        public Member save(Member member) {
            member.setId(++sequence);
            store.put(member.getId(), member);
            return member;
        }
    
        @Override
        public Optional<Member> findById(Long id) {
            return Optional.ofNullable(store.get(id));
        }
    
        @Override
        public Optional<Member> findByName(String name) {
            return store.values().stream()
                    .filter(member -> member.getName().equals(name))
                    .findAny();
        }
    
        @Override
        public List<Member> findAll() {
            return new ArrayList<>(store.values());
        }
    }
    ```
    

---

## 3. íšŒì› ë¦¬í¬ì§€í† ë¦¬ì™€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±

- ë‚´ê°€ ì‘ì„±í•œ í´ë˜ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•
- ì½”ë“œë¥¼ ì½”ë“œë¡œ ê²€ì¦í•˜ëŠ” ë°©ë²•!
- ê°œë°œí•œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•´ì„œ í…ŒìŠ¤íŠ¸ í•  ë•Œ, Javaì˜ ë©”ì¸ ë©”ì†Œë“œë¥¼ í†µí•´ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ì„œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•´ ì™”ìŒ!
â†’ ì´ëŸ¬í•œ ë°©ë²•ì€ ì¤€ë¹„í•˜ê³  ì‹¤í–‰í•˜ëŠ”ë° ì˜¤ë˜ê±¸ë¦¼!
â†’ ë°˜ë³µ ì‹¤í–‰í•˜ê¸° ì–´ë µê³  ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ í•œë²ˆì— ì‹¤í–‰í•˜ê¸° ì–´ë µë‹¤ëŠ” ë‹¨ì ì´ ìˆìŒ!
- ìë°”ëŠ” Junitì´ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì„œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•¨.
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
    
    ```java
    package com.eejuuung.hellospring.repository;
    
    import com.eejuuung.hellospring.domain.Member;
    import org.junit.jupiter.api.AfterEach;
    import org.junit.jupiter.api.Assertions;
    import org.junit.jupiter.api.Test;
    
    import java.util.List;
    import java.util.Optional;
    
    import static org.assertj.core.api.Assertions.*;
    
    class MemoryMemberRepositoryTest {
        // ìš°ì„  í…ŒìŠ¤íŠ¸ í•  í´ë˜ìŠ¤ë¥¼ ê°ì²´ë¡œ ê°€ì ¸ì˜´
        MemoryMemberRepository repository = new MemoryMemberRepository();
    
        @AfterEach
        public void afterEach(){
            repository.clearStore();
        }
    
        @Test
        public void save(){
            Member member = new Member();
            member.setName("spring");
    
            repository.save(member);
    
            //Optional ë°˜í™˜íƒ€ì… -> Optionalì—ì„œ ê°’ì„ êº¼ë‚¼ ë•ŒëŠ” getìœ¼ë¡œ êº¼ë‚¼ ìˆ˜ ìˆìŒ.
            Member result = repository.findById(member.getId()).get();
            //Assertions.assertEquals(member,result);
            assertThat(member).isEqualTo(result);
        }
    
        @Test
        public void findByName(){
            Member member1 = new Member();
            member1.setName("spring1");
            repository.save(member1);
    
            Member member2 = new Member();
            member2.setName("spring2");
            repository.save(member2);
    
            Member result = repository.findByName("spring1").get();
            //Member result = repository.findByName("spring2").get(); -> ì—ëŸ¬í™•ì¸!
    
            assertThat(result).isEqualTo(member1);
        }
    
        @Test
        public void findAll(){
            Member member1 = new Member();
            member1.setName("spring1");
            repository.save(member1);
    
            Member member2 = new Member();
            member2.setName("spring2");
            repository.save(member2);
    
            List<Member> result = repository.findAll();
    
            assertThat(result.size()).isEqualTo(2);
            //assertThat(result.size()).isEqualTo(3); -> ì—ëŸ¬í™•ì¸!
        }
    
        /**
         * ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” ìˆœì„œë‘ ìƒê´€ì—†ì´ ë©”ì†Œë“œ ë³„ë¡œ ë‹¤ ë”°ë¡œ ë™ì‘í•˜ê²Œë§Œ ì„¤ê³„ í•´ì•¼í•¨!
         * ìˆœì„œì˜ ìš°ì„ ì„±ì´ ì—†ìŒ! ì˜ì¡´í•˜ë©´ ì•ˆë¨! ì˜ì¡´ê´€ê³„ ë…¸ë…¸í•´!
         * ì¦‰, í…ŒìŠ¤íŠ¸ê°€ í•˜ë‚˜ ì‹¤í–‰í•œ í›„ì—ëŠ” ì €ì¥ì†Œë‚˜ ê³µìš”ë°ì´í„°ë“¤ì„ ê¹”ë”íˆ! ì§€ì›Œì•¼í•¨.
         * -> í…ŒìŠ¤íŠ¸ê°€ ëë‚ ë•Œë§ˆë‹¤ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì§€ì›Œì¤˜ì•¼í•¨!
         */
    }
    ```
    
- ì •ìƒì‘ë™
    
    ![Untitled](https://github.com/eejuuung/Spring_Study_Basic/assets/46306166/aaa45946-f96d-46ea-a6e1-922b6ffaf116)

    
- ì—ëŸ¬ë°œìƒì‹œ

    ![Untitled 1](https://github.com/eejuuung/Spring_Study_Basic/assets/46306166/4d5adb4e-17c1-43db-80ff-0f122f271845)

    

---

## 4. íšŒì› ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ ê°œë°œ

```java
package com.eejuuung.hellospring.service;

import com.eejuuung.hellospring.domain.Member;
import com.eejuuung.hellospring.repository.MemberRepository;
import com.eejuuung.hellospring.repository.MemoryMemberRepository;

import java.util.List;
import java.util.Optional;

public class MemberService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    /**
     * íšŒì› ê°€ì…
     */
    public Long join(Member member){
//        //ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µíšŒì›ì€ ì•ˆëœë‹¤!
//        Optional<Member> result = memberRepository.findByName(member.getName());
//        //Optionalë¡œ ê°ì‹¸ë©´ Optionalì•ˆì— ë©¤ë²„ê°ì²´ê°€ ìˆëŠ”ê²ƒ.
//        result.ifPresent(m->{
//            throw new IllegalArgumentException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
//        }); 
        validateDuplicateMember(member);    // ì¤‘ë³µíšŒì› ê²€ì¦, ctrl+alt+m
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName()).ifPresent(m->{
            throw new IllegalArgumentException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
        });
    }

    /**
     * ì „ì²´ íšŒì› ì¡°íšŒ
     */
    public List<Member> findMembers(){
        return memberRepository.findAll();
    }

    public Optional<Member> findOne(Long memberId){
        return memberRepository.findById(memberId);
    }
}
```

---

## 5. íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

- í…ŒìŠ¤íŠ¸ ì‰½ê²Œ ë§Œë“œëŠ” ë²• ë§Œë“¤ í´ë˜ìŠ¤ì´ë¦„ì—ì„œ ( ctrl + shift + T )
- í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” í•œë“¤ë¡œ ì‘ì„±í•´ë„ ë¨ ğŸ™‚
- í…ŒìŠ¤íŠ¸ì½”ë“œì˜ í˜•ì‹ ì¶”ì²œ!
1. given
2. when
3. then

- `MemberService`
    
    ```java
    package com.eejuuung.hellospring.service;
    
    import com.eejuuung.hellospring.domain.Member;
    import com.eejuuung.hellospring.repository.MemberRepository;
    import com.eejuuung.hellospring.repository.MemoryMemberRepository;
    
    import java.util.List;
    import java.util.Optional;
    
    public class MemberService {
    
        private final MemberRepository memberRepository;
    
        public MemberService (MemberRepository memberRepository) {
            this.memberRepository = memberRepository;
        }
    
        /**
         * íšŒì› ê°€ì…
         */
        public Long join(Member member){
    //        //ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µíšŒì›ì€ ì•ˆëœë‹¤!
    //        Optional<Member> result = memberRepository.findByName(member.getName());
    //        //Optionalë¡œ ê°ì‹¸ë©´ Optionalì•ˆì— ë©¤ë²„ê°ì²´ê°€ ìˆëŠ”ê²ƒ.
    //        result.ifPresent(m->{
    //            throw new IllegalArgumentException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
    //        });
            validateDuplicateMember(member);    // ì¤‘ë³µíšŒì› ê²€ì¦ ctrl+alt+m
            memberRepository.save(member);
            return member.getId();
        }
    
        private void validateDuplicateMember(Member member) {
            memberRepository.findByName(member.getName())
                    .ifPresent(m->{
                throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
            });
        }
    
        /**
         * ì „ì²´ íšŒì› ì¡°íšŒ
         */
        public List<Member> findMembers(){
            return memberRepository.findAll();
        }
    
        public Optional<Member> findOne(Long memberId){
            return memberRepository.findById(memberId);
        }
    
    }
    ```
    
- `MemberServiceTest`
    
    ```java
    package com.eejuuung.hellospring.service;
    
    import com.eejuuung.hellospring.domain.Member;
    import com.eejuuung.hellospring.repository.MemoryMemberRepository;
    import org.junit.jupiter.api.AfterEach;
    import org.junit.jupiter.api.Assertions;
    import org.junit.jupiter.api.BeforeEach;
    import org.junit.jupiter.api.Test;
    
    import static org.assertj.core.api.Assertions.*;
    import static org.junit.jupiter.api.Assertions.*;
    
    class MemberServiceTest {
    
        MemberService memberService;
        MemoryMemberRepository memberRepository;
    
        @BeforeEach
        public void BeforeEach(){
            memberRepository = new MemoryMemberRepository();
            memberService = new MemberService(memberRepository);
            //Dependency Injection = di
        }
    
        @AfterEach
        public void afterEach(){
            memberRepository.clearStore();
        }
    
        @Test
        void join() {
            //given
            Member member = new Member();
            member.setName("hello");
    
            //when
            Long saveId = memberService.join(member);
    
            //then
            Member findMember =  memberService.findOne(saveId).get();
            assertThat(member.getName()).isEqualTo(findMember.getName());   // static -> alt +enter
        }
    
        @Test
        public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸(){
            //given
            Member member1 = new Member();
            member1.setName("spring");
    
            Member member2 = new Member();
            member2.setName("spring");
    
            //when
            memberService.join(member1);
            IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));
            //assertThrows(NullpointerException.class, () -> memberService.join(member2)); -> ì‹¤íŒ¨
    
            assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    
            //then
        }
    
        @Test
        void findMembers() {
        }
    
        @Test
        void findOne() {
        }
    }
    ```
    

---
